<html>
    <head>
        <meta charset = "utf-8">
        <title> Sudoku</title>
        <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/8.1.1/math.js></script>
        <style>
            .grid{
                background-color:white;
               
                position:absolute;
            }
            .box{
                width:98px;
                height:98px;
                position:absolute;
                font-size:4em;
                text-align:center;
                line-height:95px;
            }
            .edit
            {
                width:100px;
                height:50px;
                left:925px;
                position:absolute;
                background-color:grey;
                text-align:center;
                font-size:2em;
                line-height:50px;
                border-style:solid;
            }
            .clear
            {
                width:100px;
                height:50px;
                left:1040px;
                position:absolute;
                background-color:grey;
                text-align:center;
                font-size:2em;
                line-height:50px;
                border-style:solid;
            }
            .hint
            {
                width:100px;
                height:50px;
                top:75px;
                left:925px;
                position:absolute;
                background-color:grey;
                text-align:center;
                font-size:2em;
                line-height:50px;
                border-style:solid;
            }
            .solve
            {
                width:100px;
                height:50px;
                top:75px;
                left:1040px;
                position:absolute;
                background-color:grey;
                text-align:center;
                font-size:2em;
                line-height:50px;
                border-style:solid;
            }
            
            .edit:hover,.clear:hover, .solve:hover, .hint:hover{
                background-color:lightgrey;
            }
            
            
            


        </style>
    </head>

    <body>
        <div class= "grid">  </div>
        <div class = "edit"> Edit</div>
        <div class = "clear"> Clear</div>
        <div class = "hint"> Hint</div>
        <div class = "solve"> Solve</div>
    </body>
        <script> 
        //grid system is top to bottom, then left to right, 0,1,2,3,4, then 9 is the next column etc. 
            let box=document.querySelector(".grid");
            let clrbtn=document.querySelector(".clear");
            let hintbtn=document.querySelector(".hint");
            let slvbtn=document.querySelector(".solve");

            clrbtn.addEventListener("mousedown", clear);
            hintbtn.addEventListener("mousedown",hint);   
            slvbtn.addEventListener("mousedown", solve);
            box.addEventListener("mousemove", track);
            window.addEventListener("keydown", input);
            
            let mousex=0;
            let mousey=0;
            let hovercolor="lightgreen";
            let numbers=fillbox();
            
            /*
            console.log(numbers[2][2]);
            numbers[2][2].innerHTML=5;
            numbers[1][2].innerHTML=1;
            numbers[2][3].innerHTML=2;
            numbers[3][2].innerHTML=4;
            numbers[2][1].innerHTML=3;
            */

            numbers[2][0].innerHTML=4;
            numbers[1][1].innerHTML=8;
            numbers[2][2].innerHTML=1;
            numbers[0][3].innerHTML=3;
            numbers[1][4].innerHTML=5;
            numbers[2][5].innerHTML=8;
            numbers[0][8].innerHTML=4;
            numbers[1][7].innerHTML=9;
            numbers[1][6].innerHTML=2;


            numbers[3][0].innerHTML=8;
            numbers[3][1].innerHTML=1;
            numbers[3][2].innerHTML=3;
            
            numbers[4][0].innerHTML=6;
            numbers[4][1].innerHTML=7;
            numbers[4][2].innerHTML=2;
            numbers[5][2].innerHTML=9;


            numbers[3][3].innerHTML=5;
            numbers[3][6].innerHTML=6;


            numbers[4][3].innerHTML=4;
            numbers[4][5].innerHTML=3;
            numbers[5][5].innerHTML=1;

            numbers[4][6].innerHTML=9;
            numbers[4][7].innerHTML=5;
            numbers[4][8].innerHTML=1;
            numbers[5][6].innerHTML=7;
            numbers[5][7].innerHTML=8;
            numbers[5][8].innerHTML=3;


            numbers[8][0].innerHTML=1;
            numbers[7][1].innerHTML=3;
            numbers[7][2].innerHTML=5;

            numbers[6][3].innerHTML=9;
            numbers[7][4].innerHTML=4;
            numbers[8][5].innerHTML=7;


            numbers[6][6].innerHTML=3;
            numbers[7][7].innerHTML=2;
            numbers[6][8].innerHTML=8;
            
            console.log(solved());
            function getposval()
            {
                let p=[];
                for(let i =0; i<9; i++)
                {
                    p.push([]);
                    for(let j=0; j<9; j++)
                    {
                        p[i].push([]);
                        if(numbers[i][j].innerHTML=="")
                        {
                            let list=[];
                            for(let k=1; k<=9; k++)
                            {
                                if(possible(k, [i,j]))
                                    list.push(k);
                            }
                                p[i][j]=list;
                        }
                    }
                }
                return p;
            }

            function solve()
            {
                
                while(hint())
                {  
                    if(solved())
                    {
                        return true;
                    }
                }
                return false;
            }




            function guess(pos)
            {
                let min=Infinity;
                let spot=[];
                for(let i =0; i<9; i++)
                {
                    for(let j=0; j<9; j++)
                    {
                        if(pos[i][j].length<min &&numbers[i][j].innerHTML=="")
                        {
                            min=pos[i][j].length;
                            spot=[i,j];
                        }
                    }
                }
                console.log(spot);
            }

            function solved()
            {
                for(i=0; i<9; i++)
                {
                    for(j=0; j<9; j++)
                    {
                        if(numbers[i][j].innerHTML=="")
                            return false;
                    }
                }
                return true;
            }

            function method1(pos)           //basic logic, if there's only 1 number that can go in a spot, fill that spot with the number.
            {
                for(let i =0; i<9; i++)             
                {
                    for(let j=0; j<9; j++)
                    {
                        if(pos[i][j].length==1)
                            {
                                numbers[i][j].innerHTML=pos[i][j][0];
                                numbers[i][j].style.backgroundColor="pink";
                                return true;
                            }
                    }
                }
                return false;
            }

            function method2(pos)               //column logic, if there's only 1 spot for a number in that column, it goes in that spot.
            {
                for(let i =0; i<9; i++)                                         
                {
                    for(let j=1; j<=9; j++)
                    {
                            let temp=[];
                            for(let k=0; k<9; k++)
                            {
                                if(pos[i][k].includes(j)&&(numbers[i][k].innerHTML==""))
                                    temp.push(k);
                            }
                            if(temp.length==1)
                            {
                                numbers[i][temp[0]].innerHTML=j;
                                numbers[i][temp[0]].style.backgroundColor="yellow";
                                return true;
                            }
                    }
                }
                return false;
            }

            function method3(pos)               //row logic, if there's only 1 spot for a number in that row, it goes in that spot.
            {
                for(let k =0; k<9; k++)                                         
                {
                    for(let j=1; j<=9; j++)
                    {
                            let temp=[];
                            for(let i=0; i<9; i++)
                            {
                                if(pos[i][k].includes(j)&&(numbers[i][k].innerHTML==""))
                                    temp.push(i);
                            }
                            if(temp.length==1)
                            {
                                numbers[temp[0]][k].innerHTML=j;
                                numbers[temp[0]][k].style.backgroundColor="purple";
                                return true;
                            }
                        
                    }
                }
                return false;
            }

            function method4(pos)               //3x3 box logic, if there's only 1 spot for a number in a box, set that spot to that number.
            {
                for(let i=0; i<3; i++)                                              
                {
                    for(let j=0; j<3; j++)
                    {
                        for(let k=1; k<9; k++)
                        {
                            let temp=[]
                            for(let ii=0; ii<3; ii++)
                            {
                                for(let jj=0; jj<3; jj++)
                                {
                                    if(pos[3*i+ii][3*j+jj].includes(k)&&numbers[3*i+ii][3*j+jj].innerHTML=="")
                                        {
                                            temp.push(ii);
                                            temp.push(jj);
                                        }
                                }
                            }
                            if(temp.length==2)
                            {
                                console.log("box "+i + " " + j);
                                numbers[3*i+temp[0]][3*j+temp[1]].innerHTML=k;
                                numbers[3*i+temp[0]][3*j+temp[1]].style.backgroundColor="blue";
                                return true;
                            }   
                        }
                    }
                }
                return false;
            }

            function hint()
            {
                let possibilities=getposval();
                if(method1(possibilities))
                    return true;
                if(method2(possibilities))
                    return true;
                if(method3(possibilities))
                    return true;
                if(method4(possibilities))
                    return true;
                return false;
            }

            function clear()
            {
                for(let i =0; i<9; i++)
                {
                    for(let j=0; j<9; j++)
                    {
                        numbers[i][j].innerHTML="";
                        numbers[i][j].style.backgroundColor="white";
                    }
                }
            }

            function possible(num, position)
            {
                for(let i =0; i<9; i++)
                    if(numbers[i][position[1]].innerHTML==num||numbers[position[0]][i].innerHTML==num)
                        return false;
                        
                let xbound=parseInt(position[0]/3)*3;
                let ybound=parseInt(position[1]/3)*3;
                for(let i =xbound; i<xbound+3; i++)
                    for(let j=ybound; j<ybound+3; j++)
                        if(numbers[i][j].innerHTML==num||numbers[i][j].innerHTML==num)
                            return false;
                return true;
            }
            
            function input(e)
            {
                let x=parseInt(mousex/100);
                let y=parseInt(mousey/100);
                let currentbox=numbers[x][y];
                
                if(e.keyCode>=49&&e.keyCode<=57&&currentbox.innerHTML=="")  
                {   
                    if(possible(e.keyCode-48, [x,y]))
                    {
                        currentbox.innerHTML=e.keyCode-48;
                        flash(currentbox, "lightgreen");
                    }
                    else
                    {
                        console.log("flash");
                        flash(currentbox, "red");
                    }
                }
                
            }

            function flash(b, color)
            {
                b.style.backgroundColor=color;
                setTimeout(function(){b.style.backgroundColor="white";}, 200);
            }

            function fillbox()
            {
                let nums=[];
                for(let i=0; i<9; i++)
                {
                    let temp=[]
                    for(let j=0; j<9; j++)
                    {
                        let x = i*100
                        let y = j*100
                        let sq=document.createElement("div");
                        sq.className="box";
                        sq.dataset.key=i+9*j;
                        
                        sq.style.left=x+"px";
                        sq.style.top=y+"px";
                        sq.style.borderStyle="solid";
                        sq.style.borderWidth="1px";
                        if(i==0)
                        {
                            sq.style.borderLeftWidth="6px";
                            sq.style.width="93px";
                        }
                        if(i==2)
                        {
                            sq.style.borderRightWidth="3px";
                            sq.style.width="96px";
                        }
                        if(i==3)
                        {
                            sq.style.borderLeftWidth="3px";
                            sq.style.width="96px";
                        }
                        if(i==5)
                        {
                            sq.style.borderRightWidth="3px";
                            sq.style.width="96px";
                        }
                        if(i==6)
                        {
                            sq.style.borderLeftWidth="3px";
                            sq.style.width="96px";
                        }
                        if(i==8)
                        {
                            sq.style.borderRightWidth="6px";
                            sq.style.width="93px";
                        }
                        if(j==0)
                        {
                            sq.style.borderTopWidth="6px";
                            sq.style.height="93px";
                        }

                        if(j==2)
                        {
                            sq.style.borderBottomWidth="3px";
                            sq.style.height="96px";
                        }
                        if(j==3)
                        {
                            sq.style.borderTopWidth="3px";
                            sq.style.height="96px";
                        }
                        if(j==5)
                        {
                            sq.style.borderBottomWidth="3px";
                            sq.style.height="96px";
                        }
                        if(j==6)
                        {
                            sq.style.borderTopWidth="3px";
                            sq.style.height="96px";
                        }
                        if(j==8)
                        {
                            sq.style.borderBottomWidth="6px";
                            sq.style.height="93px";
                        }
                        //sq.addEventListener("mouseover", function(){sq.style.backgroundColor=hovercolor;});
                        //sq.addEventListener("mouseout", function() { sq.style.backgroundColor="white";});
                        box.appendChild(sq);
                        temp.push(sq);
                    }
                    nums.push(temp);
                }
                return nums;
            }
            
            function track(e)
            {
                mousex=e.clientX-box.getBoundingClientRect().left;
                mousey=e.clientY-box.getBoundingClientRect().top;
            }
        
        
        
        
        
        
        </script>
</html>